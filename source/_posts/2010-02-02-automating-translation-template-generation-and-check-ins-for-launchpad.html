---
layout: post
title: "Automating translation template generation and check-ins for Launchpad"
date: 2010-02-02
comments: false
---

<div class='post'>
I <a href="http://mrooney.blogspot.com/2009/07/launchpad-is-now-automatic-magical.html">previously wrote</a> about how excited I was for the automated translation import and export features of Launchpad. Launchpad will automatically notice when you commit a translation template and import it, making it available for translation online. Generous translators will then contribute translations, and Launchpad will commit them back to your project.<br /><br /><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer;width: 149px; height: 200px;" src="http://2.bp.blogspot.com/_HU7L5oFDSeA/S2fxD3QRaNI/AAAAAAAAAbI/AfTFW4D9U7s/s400/thumbsup.jpg" border="0" alt="" id="BLOGGER_PHOTO_ID_5433576524119894226" /><br />Okay, so this is pretty good! However for this process to work well, the translation template needs to be generated manually by a developer whenever there are changes to strings. Otherwise, translators are working on potentially outdated strings; some are perhaps not in the application anymore, and there are likely some strings which aren't in the template yet.<br /><br />After forgetting to generate and commit my template until shortly before a release more than once (and thus having poor translation coverage on newly added strings), I decided to automate this part of the process as well. All it took was a relatively small script to generate the template, and then if there were any changes, commit and push to the branch configured for automatic import in Launchpad. The following script does just that, by searching for any files using gettext calls starting with _(" or _(', and passing them to xgettext.<br /><br /><pre class="brush: bash"><br />#!/bin/bash<br />set -e<br />ack-grep "_\([\"\']" -l | xargs xgettext --output=wxbanker/po/wxbanker.pot<br />ACTUALCHANGES="`bzr diff | grep \"^[\-\+]msg\" | wc -l`"<br />if [[ "$ACTUALCHANGES" != "0" ]]; then<br />  bzr ci -m "automated generation of translation template"<br />  bzr push :parent<br />fi<br /></pre><br /><br />Note that if you aren't using Python, you may need to tweak the regular expression supplied to ack-grep. Once the template is generated, the diff is piped through grep to grab any changes to actual messages and make sure there was at least one. Otherwise there would always be changes due to the timestamp in the template, causing useless commits.<br /><br />I then threw this script into a <a href="http://hudson-ci.org/">Hudson</a> job, the <a href="http://en.wikipedia.org/wiki/Continuous_integration">Continuous Integration server</a> I use for <a href="https://launchpad.net/wxbanker">wxBanker</a>. I configured this particular job to run nightly, pulling down the latest bzr branch beforehand, and emailing me on any failures.<br /><br />It seems to be working quite well and ensures translators are always translating the latest strings and leaves nothing for me to forget, smoothing out the release process.<br /><br />If this sounds interesting to you but you're not familiar with Launchpad as a translation system, check out <a href="http://blog.launchpad.net/general/trying-out-launchpad-translations">http://blog.launchpad.net/general/trying-out-launchpad-translations</a> and feel free to ask any questions here. If you do have experience with translations, how do you handle generating translation templates and then integrating the translations?</div>
